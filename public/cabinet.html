<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cabinet</title>
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: url("background.jpg") no-repeat center/cover;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  color: white;
  min-height: 100vh;
  padding: 30px 0;
}
.container {
  width: 800px;
  background: rgba(255 255 255 / 0.15);
  backdrop-filter: blur(15px);
  border-radius: 20px;
  padding: 20px;
  box-sizing: border-box;
}
#cabinetButtons {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}
button {
  padding: 8px 14px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  background: rgba(0,0,0,0.6);
  color: white;
  font-weight: bold;
  transition: background 0.3s ease, transform 0.2s ease;
}
button:hover {
  background: rgba(0,0,0,0.8);
  transform: scale(1.05);
}
.profile-info {
  display: flex;
  gap: 20px;
  align-items: center;
}
.profile-photo {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid white;
  background: #ccc;
}
.profile-details {
  flex: 1;
}
.profile-details h2 {
  margin: 0 0 10px;
  font-size: 28px;
}
.profile-details p {
  margin: 5px 0;
  font-size: 18px;
}
input[type="file"] {
  margin-top: 10px;
}
</style>
</head>
<body>

<div class="container">

  <!-- BUTTONS -->
  <div id="cabinetButtons"></div>

  <!-- PROFILE INFO -->
  <div class="profile-info">
    <img id="profilePhoto" class="profile-photo" src="guest.png" alt="Profile Photo" />
    <div class="profile-details">
      <h2 id="profileName"></h2>
      <p id="profileNickname"></p>
      <p id="profileUsername" style="font-style: italic; color: #ccc;"></p>
      <!-- Upload image input if viewing own profile -->
      <input type="file" id="uploadPhoto" accept="image/*" style="display:none;">
    </div>
  </div>

</div>

<script>
const loggedUser = localStorage.getItem("loggedUser");
if (!loggedUser) window.location.href = "login.html";

const urlParams = new URLSearchParams(window.location.search);
let viewUser = urlParams.get("user");
if (!viewUser) viewUser = loggedUser;

const buttonsDiv = document.getElementById("cabinetButtons");
const profileNameEl = document.getElementById("profileName");
const profileNicknameEl = document.getElementById("profileNickname");
const profilePhotoEl = document.getElementById("profilePhoto");
const profileUsernameEl = document.getElementById("profileUsername");
const uploadPhotoInput = document.getElementById("uploadPhoto");

const classmates = {
  "akramov.akmal":"Akramov Akmal",
  "choriyev.miraziz":"Choriyev Miraziz",
  "kuldashev.javohir":"Kuldashev Javohir",
  "ziyomitdinov.elshod":"Ziyomitdinov Elshod",
  "nishonov.shoxrux":"Nishonov Shoxrux",
  "ravshanov.bexruz":"Ravshanov Bexruz",
  "furqatov.ulugbek":"Furqatov Ulug'bek",
  "jorayev.isomiddin":"Jorayev Isomiddin",
  "ismatullayev.xurshid":"Ismatullayev Xurshid",
  "ashurov.akmal":"Ashurov Akmal",
  "ilhomov.muhammadsiddiq":"Ilhomov Muhammadsiddiq",
  "radjabova.madinabonu":"Radjabova Madinabonu",
  "bakirova.shabnam":"Bakirova Shabnam",
  "muhammadov.baxtinur":"Muhammadov Baxtinur",
  "abduvohidov.abdurahmon":"Abduvohidov Abdurahmon",
  "mirzaraximov.mirmag'rur":"Mirzaraximov Mirmag'rur",
  "doniyorova.dilnoza":"Doniyorova Dilnoza",
  "anarkulova.amira":"Anarkulova Amira",
  "karimjonova.madina":"Karimjonova Madina",
  "baratov.jaloliddin":"Baratov Jaloliddin",
  "ergashaliyev.diyor":"Ergashaliyev Diyor",
  "miraxmedov.dilnur":"Miraxmedov Dilnur",
  "yusupov.elshodbek":"Yusupov Elshodbek",
  "madraximov.sardor":"Madraximov Sardor"
};

// Show buttons if viewing own profile
if (viewUser === loggedUser) {
  const classmatesBtn = document.createElement("button");
  classmatesBtn.textContent = "My Classmates";
  classmatesBtn.onclick = () => window.location.href = "index.html";
  buttonsDiv.appendChild(classmatesBtn);

  const chatBtn = document.createElement("button");
  chatBtn.textContent = "Chat";
  chatBtn.onclick = () => window.location.href = "chat.html";
  buttonsDiv.appendChild(chatBtn);

  const changePassBtn = document.createElement("button");
  changePassBtn.textContent = "Change Password";
  changePassBtn.onclick = () => window.location.href = "change-password.html";
  buttonsDiv.appendChild(changePassBtn);

  const logoutBtn = document.createElement("button");
  logoutBtn.textContent = "Log Out";
  logoutBtn.onclick = () => {
    localStorage.removeItem("loggedUser");
    window.location.href = "login.html";
  };
  buttonsDiv.appendChild(logoutBtn);

  // Show file input
  uploadPhotoInput.style.display = "block";
}

// Set profile info
profileNameEl.textContent = classmates[viewUser] || viewUser;
profileUsernameEl.textContent = `Username: ${viewUser}`;
const nickname = localStorage.getItem("nickname_" + viewUser);
profileNicknameEl.textContent = nickname ? `Nickname: ${nickname}` : "";

// Set photo
const photo = localStorage.getItem("photo_" + viewUser);
profilePhotoEl.src = photo ? photo : "guest.png";

// Handle photo upload
uploadPhotoInput.addEventListener("change", (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    localStorage.setItem("photo_" + loggedUser, reader.result);
    profilePhotoEl.src = reader.result;
  };
  reader.readAsDataURL(file);
});
</script>

</body>
</html>
